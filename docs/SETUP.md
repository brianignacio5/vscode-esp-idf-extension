# ESPRESSIF IDF extension for Visual Studio Code

When you start ESP-IDF extension, it will try to self-configure by looking for existing ESP-IDF directory in `~/esp/esp-idf` on MacOS/Linux and `%USERPROFILE%\esp\esp-idf` or `%USERPROFILE%\Desktop\esp-idf` in Windows. It will look for ESP-IDF Tools and ESP-IDF Python virtual environment in `~\.espressif` on MacOS/Linux and `%USERPROFILE%\.espressif` on Windows.

If ESP-IDF and required ESP-IDF tools are found, these paths will be saved as Visual Studio Code Configuration settings, which are located in `press F1 -> type Preferences: Open Settings (UI)` and `press F1 -> type Preferences: Open Settings (JSON)`. These settings, as described in [README ESP-IDF Specific Settings](../README.md), are `idf.espIdfPath` for IDF_PATH, `idf.customExtraPaths` for ESP-IDF Tools paths to be appended to environment variable PATH, `idf.pythonBinPath` for absolute virtual environment python path and `idf.customExtraVars` for additional environment variables from ESP-IDF tools such as OPENOCD_SCRIPTS.

If ESP-IDF and tools are not downloaded yet, you can use the [Setup Wizard](#Setup-Wizard) to download them and configure the extension for you or manually configure the extension as explained in [JSON Manual Configuration](#JSON-Manual-Configuration) or [Settings UI Manual Configuration](#UI-Manual-Configuration).

## Setup Wizard

In Visual Studio Code press **F1** and type **ESP-IDF: Configure ESP-IDF extension**.

Setup wizard provides 3 choices:

- Express install: Fastest option. Choose to either download selected ESP-IDF version or find ESP-IDF in your system, install ESP-IDF Tools and create python virtual environment with required packages on the path specified in `idf.toolsPath` on MacOS/Linux or `idf.toolsPathWin` in Windows, which has a default path value of in `~\.espressif` on MacOS/Linux and `%USERPROFILE%\.espressif` on Windows, respectively.
- Advanced install: Configurable option. Choose to either download selected ESP-IDF version or find ESP-IDF in your system, install ESP-IDF Tools and create python virtual environment with required packages in the chosen location or manually specify each required ESP-IDF tool path.
- Use existing setup: If ESP-IDF is found in `idf.espIdfPath` (or `~/esp/esp-idf` on MacOS/Linux and `%USERPROFILE%\esp\esp-idf` or `%USERPROFILE%\Desktop\esp-idf` in Windows) and ESP-IDF tools in `idf.toolsPath` (or `~\.espressif` on MacOS/Linux and `%USERPROFILE%\.espressif` in Windows) then this option is shown to use an existing setup, install extension and extension debug adapter python requirements.

After choosing any of the previous options, a status page is displayed showing ESP-IDF, tools and python environment install status. When the setup is finished, a message is shown that "All settings have been configured. You can close this window."

## JSON Manual Configuration

1. In Visual Studio Code press **F1** and type **Preferences: Open Settings (JSON)**. This will open your user global settings for Visual Studio Code. You could choose to modify your workspace settings.json if you want these settings for a workspace-specific or folder-specific `.vscode/settings.json`.
2. Your settings.json should look like:

```
{
    ...,
    "idf.espIdfPath": "path/to/esp-idf",
    "idf.customExtraPaths": "UPDATED_PATH",
    "idf.customExtraVars": "{\"OPENOCD_SCRIPTS\":\"OPENOCD_FOLDER/share/openocd/scripts\"}",
    "idf.pythonBinPath": "PYTHON_INTERPRETER"
}
```

where **UPDATED_PATH** is the "Updated PATH variable" generated by `$IDF_PATH/export.sh`, **PYTHON_INTERPRETER** is the "Using Python interpreter in" value generated by `$IDF_PATH/export.sh`, the device port is your device serial port (COM1, /dev/cu.usbserial-1433401, etc) and idf.openOcdConfigs are the config files used for OpenOCD for your device (they are relative to OPENOCD_SCRIPTS directory).

**DO NOT USE ~, $HOME OR %USERPROFILE%, ENVIRONMENT VARIABLES ARE NOT RESOLVED IN THIS CONFIGURATION SETTINGS. You could use ${env:HOME} to refer to \$HOME (Linux/MacOS) or %HOME% (Windows).**

Make sure to install the extension and extension debug adapter Python requirements by running the following commands in your terminal:

`PYTHON_INTERPRETER -m pip install -r EXTENSION_PATH/requirements.txt`
`PYTHON_INTERPRETER -m pip install -r EXTENSION_PATH/esp_debug_adapter/requirements.txt`

### Example configuration setting values

An example python path for `idf.pythonBinPath` is `/home/myUser/.espressif/python_env/idf4.0_py3.5_env/bin/python` for MacOS/Linux users or `C:\Users\myUser\.espressif\python_env\idf4.0_py3.5_env\Scripts\python.exe` for Windows users.

For example if required ESP-IDF Tools are:

- OpenOCD executable path is _/home/myUser/.espressif/tools/openocd/version/openocd-esp32/bin/openocd_ or _C:\Users\myUser\.espressif\tools\openocd\version\openocd-esp32\bin\openocd_ (Windows)
- XtensaEsp32 executable path is _/home/myUser/.espressif/tools/xtensa-esp32/version/xtensa-esp32/bin/xtensa-esp32-gcc_ or _C:\Users\myUser\.espressif\tools\xtensa\version\xtensa-esp32\bin/xtensa-esp32-gcc_ (Windows)

you need to set in `idf.customExtraPaths`:

- Linux/MacOS users

```
/home/myUser/\.espressif\tools\openocd\version\openocd-esp32\bin:/home/myUser/.espressif/tools/xtensa-esp32/version/xtensa-esp32/bin
```

- Windows users

```
C:\Users\myUser\.espressif\tools\openocd\version\openocd-esp32\bin;C:\Users\myUser\.espressif\tools\xtensa-esp32\version\xtensa-esp32\bin
```

`idf.customExtraVars` is an object saved in Visual Studio Code's settings.json that looks like this (**Make sure to replace \${TOOL_PATH} with the tool path**):

```
{
    ...,
    OPENOCD_SCRIPTS: "...",
    OTHER_ENV_VAR: "...",
    ...
}
```

The list of required `idf.customExtraVars` can be found in `$IDF_PATH/tools/tools.json` (replace **\${TOOL_PATH}** with tool location) and they should be filled for the extension to work properly.

## UI Manual Configuration

This is the same as previous sections but the name of each configuration setting is the description given in the [Readme ESP-IDF Settings](./../README.md). You also need to install requirements.txt as shown in the previous section.
